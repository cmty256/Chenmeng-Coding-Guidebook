---
title: JVM常问
date: 2023-08-29 21:24:27
permalink: /pages/ff3623/
---
# JVM 常问

## *问题 1：什么是JVM？*

**答案**： Java虚拟机（JVM）是Java编程语言的运行时环境，它负责将Java源代码编译为字节码并执行。它提供了内存管理、垃圾回收、类加载、即时编译等功能。

## *问题 2：JVM的主要组成部分有哪些？*

**答案**： JVM由三个主要的子系统组成：类加载器（Class Loader）、运行时数据区（Runtime Data Area）和执行引擎（Execution Engine）。

## *问题 3：JVM的内存模型是什么？*

**答案**： JVM的内存模型分为线程私有区域和线程共享区域。

1. 线程私有区域包括
   - 程序计数器、
   - 虚拟机栈和本地方法栈。
2. 线程共享区域包括
   - 堆、
   - 方法区（元空间）和直接内存。

## *问题 4：什么是Java堆？它的作用是什么？* 

**答案**： Java堆是存储对象实例的地方，也是垃圾回收的主要区域。所有线程共享堆，它可以分为新生代和老年代，新生代又分为Eden空间、Survivor空间。

老年代是用于存放生命周期较长的对象，经过多次垃圾回收仍然存活的对象会被移到老年代。老年代相对于新生代而言，其垃圾回收频率较低。

这种分代的设计可以优化垃圾回收的效率，将对象按照生命周期进行分类，有助于提高内存利用率和性能。

## *问题 5：Java堆中的永久代（PermGen）已被废弃，取而代之的是什么？* 

**答案**： Java堆中的永久代已被元空间（Metaspace）取代。元空间存储【类的元数据信息】，如类名、方法、字段等，避免了永久代可能引起的内存溢出问题。

## *问题 6：什么是垃圾回收（Garbage Collection）？它的目的是什么？* 

**答案**： 垃圾回收是JVM自动管理内存的过程，用于释放不再被引用的对象所占用的内存。其目的是避免内存泄漏，使程序能够有效地使用内存。

## *问题 7：谈谈垃圾回收算法的类型和原理。* 

**答案**： 垃圾回收算法有 标记-清除、复制、标记-整理 等。

其中

- **标记-清除**通过标记不再被引用的对象，然后清除它们；
- **复制算法**将堆分为两个区域，每次只使用其中一个，将存活对象复制到另一个区域；
- **标记-整理**通过标记存活对象并整理内存，将存活对象移动到一端，然后清除其余部分。

## *问题 8：什么是Java内存溢出（OutOfMemoryError）？怎么避免？*

**答案**： Java内存溢出是指JVM中没有足够内存分配给新的对象。

可以通过增加堆大小、优化代码、释放不再使用的对象、使用合适的数据结构等方式来避免内存溢出。

## *问题 9：什么是Java内存泄漏？如何避免？* 

**答案**： Java内存泄漏是指不再使用的对象仍然被保留在内存中，导致内存占用不断增加。

避免内存泄漏的方法包括正确地关闭资源、使用弱引用、及时清除不再使用的引用等。

## *问题 10：什么是类加载器（Class Loader）？有哪些类加载器？* 

**答案**： 类加载器负责将类的字节码加载到JVM中并生成对应的Class对象。主要的类加载器有引导类加载器、扩展类加载器和应用程序类加载器。

## *问题 11：什么是双亲委派模型（Parent Delegation Model）？它的作用是什么？* 

**答案**： 双亲委派模型是指类加载器在加载类时首先委派给父类加载器，只有在父类加载器找不到对应的类时才尝试自己加载。这种模型保证了类的一致性和防止类的重复加载。

## *问题 12：什么是类初始化和实例初始化？它们的执行顺序是怎样的？*

**答案**： 

- 类初始化是在类加载过程中执行的静态初始化代码块，
- 实例初始化是在创建对象时执行的实例初始化代码块。

类初始化在类加载过程中只执行一次，实例初始化在每次创建对象时都会执行。

执行顺序是：父类的类初始化 -> 子类的类初始化 -> 父类的实例初始化 -> 子类的实例初始化。



1. **JVM的组成部分：** JVM由类加载器、执行引擎、内存区域（堆、方法区、栈、本地方法栈和程序计数器）等组成，用于执行Java字节码。
2. **Java内存区域：** Java内存区域包括堆（存放对象实例）、方法区（存放类信息、静态变量等）、栈（存放局部变量、方法调用等）、本地方法栈（为本地方法服务）和程序计数器（指向当前执行的字节码指令）。
3. **垃圾回收机制：** 垃圾回收是自动释放不再使用的内存空间的过程，Java中常见的垃圾回收算法有标记-清除、标记-整理、复制、分代等。
4. **垃圾回收器：** 常见的垃圾回收器有Serial、Parallel、CMS、G1等，它们各有特点，如适用于不同的应用场景和需求。
5. **垃圾回收的算法：** 标记-清除算法先标记需要回收的对象，然后清除未标记的对象；标记-整理算法在标记后，将存活的对象整理到内存的一端；复制算法将内存分为两个部分，垃圾回收时将存活的对象复制到另一部分，然后清空原部分。
6. **内存分配与回收：** Java对象通过垃圾回收自动释放内存，可以通过构造函数、对象的引用等方式分配内存。引用计数是一种内存分配的策略，但Java并不使用它。
7. **对象的生命周期：** 对象的生命周期包括加载、使用、不再使用和垃圾回收等阶段。
8. **JVM调优：** 调优涉及堆大小、堆中代的比例、垃圾回收器的选择等，可以通过命令行参数或配置文件进行调整。
9. **类加载机制：** 类加载器用于加载类的字节码，包括Bootstrap、ExtClassLoader、AppClassLoader等。类加载器的双亲委派模型是指类加载器会首先委托父加载器寻找类。
10. **字节码和反编译：** 字节码是编译后的Java代码，反编译工具可以将字节码还原为Java代码。
11. **类加载过程：** 类加载包括加载、验证、准备、解析和初始化等步骤。类加载器首先会加载类的字节码，然后进行验证、准备和解析，最后进行初始化。
12. **字符串常量池：** 字符串常量池存放字符串字面值，intern()方法可将字符串放入字符串常量池。
13. **并发与JVM：** 并发环境下需考虑内存可见性、原子性和有序性。JVM提供同步机制来保证多线程环境下的安全性。
14. **JVM的新特性：** 比如Java 11引入的局部变量类型推断、Java 17中的Pattern Matching等。