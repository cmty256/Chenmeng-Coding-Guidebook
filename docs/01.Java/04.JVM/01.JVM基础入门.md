# JVM 基础入门

## JVM 基础

### 聊一聊 Java 从编码到执行到底是一个怎么样的过程？

![image-20230811223459658](C:/Users/乔/AppData/Roaming/Typora/typora-user-images/image-20230811223459658.png)

假设我们有一个文件 `x.Java`，你执行 `javac`，它就会变成 `x.class`。

*这个 class 怎么执行的？*

当我们调用 Java 命令的时候，class 会被 load 到内存，这块叫【Classloader】，会被 Classloader 装载到内存里。

一般的情况下，我们写自己的类文件的时候也会用到 【Java 的类库】，所以他会把 Java 类库相关的这些个类也要装载到内存里，装载完成之后会调用【字节码解释器】或者是【JIT 即时编译器】来进行解释或编译，编译完之后由【执行引擎】开始执行，这以及下面面对的，那就是操作系统和硬件了。 

Java 编译好了之后变成 class， class 会被 load 到内存，与此同时像什么 string， object 这些个 class 也都会被 load 到内存。

*Java 是这个解释执行的还是编译执行的？*

其实解释和编译是可以混合的，特别常用的一些代码，代码用到的次数特别多，这个时候他会把代码做成一个及时的编译，做成一个本地的编译。

你可以理解为就像 c 语言在 Windows 上执行的时候，把它编译成 exe 一样，那么下次再执行这段代码的时候，就不需要通过解释器来一句一句解释来执行了，执行引擎可以直接交给操作系统去让它调用，这个效率要高很多，不是所有的代码都要都会被 GIT 进行及时编译的，如果是这样的话，那整个 Java 就完全变成了不能跨平台了。

所以有一些特定的，执行起来执行次数好多好多，用的特别多的时候，这个时候会进行一个即时编译器的编译。

### 什么是 JVM?

所谓的 JVM 虚拟机，其实它本身是一个规范，是虚构出来的一台计算机。拥有自己的操作系统，是一个跨语言平台。

*为什么 JVM 虚拟机能够支持多种语言运行在上面呢？*

最关键的原因是就是因为 class 这个东西，我们可以说任何的语言，只要你能编译成 class，符合 class 文件的规范，你就可以扔在 Java 虚拟机上去执行。

**注意：JVM 只和 class 文件有关，与 java 无关。**

JDK 官网：[Java SE Specifications (oracle.com)](https://docs.oracle.com/javase/specs/)

维基百科：[Java虚拟机 - 维基百科，自由的百科全书 (wikipedia.org)](https://zh.wikipedia.org/wiki/Java虚拟机)

甲骨文中国：[Java 软件 | Oracle 中国](https://www.oracle.com/cn/java/)

### 常见的 JVM 实现

1. Hotspot（最常用）
   - oracle 官方，我们做实验用的 JVM，Java 虚拟机
   - `java -version` 命令可查看使用的是什么 JVM
   - **Hotspot 8 之后要收费，但 Open JDK 是开源的版本，免费**

2. Jrockit
   - BEA 曾经号称世界上最快的 JVM 
   - 被 Oracle 收购，合并于 hotspot

3. TaobaoVM（免费）
   - hotspot 深度定制版

4. LiquidVM
   - 直接针对硬件

5. azul zing（特别贵）
   - 最新垃圾回收的业界标杆（号称 1ms 以内）
   - www.azul.com

6. J9-IBM
   - Microsoft VM

### JDK JRE JVM 的关系

包含关系。

JVM -- 运行 java 字节码的虚拟机

JRE -- java 运行环境 == jvm + core（核心类库）

JDK -- java 开发工具包 == jre + development kit（开发工具） 

## Class 文件格式

Class 文件格式（*File Format*）

- 二进制字节流（由 java 虚拟机解释）
- 数据类型: u1 u2 u4 u8 和 _info (表类型)
  - info 的来源是 hotspot 源码中的写法
- 查看 16 进制格式的 ClassFile
  - 软件 - sublime / notepad /
  - IDEA 插件 - BinEd
- 有很多可以更好观察 ByteCode 的方法
  - 终端命令：`javap <class文件路径>`，`-v` 参数详细查看
  - JBE 可以直接修改
  - JClassLib - IDEA 插件之一